<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Student Opportunities</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:transparent;
}

.wrap{
  max-width:1100px;
  margin:auto;
  padding:12px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
}

@media(max-width:900px){
  .grid{grid-template-columns:repeat(2,1fr);}
}
@media(max-width:600px){
  .grid{grid-template-columns:1fr;}
}

.card{
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:16px;
  background:white;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.title{
  margin:0 0 12px 0;
  font-size:20px;
}

.meta{
  font-size:14px;
  margin-bottom:14px;
}

.meta div{
  margin-bottom:6px;
}

button{
  background:#111827;
  color:white;
  border:none;
  padding:10px 14px;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}

button:hover{
  background:black;
}

.backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.backdrop.open{
  display:flex;
}

.modal{
  background:white;
  max-width:700px;
  width:100%;
  border-radius:18px;
  padding:20px;
}

.close{
  float:right;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="wrap">
  <div id="grid" class="grid"></div>
</div>

<div id="backdrop" class="backdrop">
  <div class="modal">
    <div>
      <span id="closeBtn" class="close">âœ•</span>
      <h2 id="modalTitle"></h2>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>

// ===============================
// ðŸ”´ PASTE YOUR PUBLISHED CSV LINK BELOW
// ===============================
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSrvzLfDN30Re_NAwIKCx3V1RTU1A_58ohgRA2dSLyDLJmSgFPMYK0YgcF2SsbgaYVT0QmY5ZYsN666/pub?gid=1646305040&single=true&output=csv";
// ===============================


let opportunities = [];

const grid = document.getElementById("grid");
const backdrop = document.getElementById("backdrop");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");
const closeBtn = document.getElementById("closeBtn");

function parseCSV(text){
  const rows = [];
  let row = [];
  let cell = "";
  let inQuotes = false;

  for(let i=0;i<text.length;i++){
    const c = text[i];
    const next = text[i+1];

    if(c === '"' && inQuotes && next === '"'){
      cell += '"';
      i++;
      continue;
    }

    if(c === '"'){
      inQuotes = !inQuotes;
      continue;
    }

    if(c === "," && !inQuotes){
      row.push(cell);
      cell = "";
      continue;
    }

    if((c === "\n" || c === "\r") && !inQuotes){
      if(c === "\r" && next === "\n") i++;
      row.push(cell);
      rows.push(row);
      row = [];
      cell = "";
      continue;
    }

    cell += c;
  }

  if(cell.length || row.length){
    row.push(cell);
    rows.push(row);
  }

  return rows;
}

async function loadData(){
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = parseCSV(text);

  // skip header row (row 0)
  for(let i=1;i<rows.length;i++){
    const r = rows[i];

    if(!r[1]) continue; // skip if no title

    opportunities.push({
      id: "row-" + i,
      title: r[1],        // Column B
      description: r[2] || "",  // Column C (change if needed)
      url: r[3] || "",    // Column D (change if needed)
      domain: r[30] || "",      // AE
      eduLevel: r[31] || "",    // AF
      locationType: r[32] || "" // AG
    });
  }

  renderCards();
}

function renderCards(){
  grid.innerHTML = "";

  opportunities.forEach(opp => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3 class="title">${opp.title}</h3>
      <div class="meta">
        <div><strong>Domain:</strong> ${opp.domain}</div>
        <div><strong>Education Level:</strong> ${opp.eduLevel}</div>
        <div><strong>Location Type:</strong> ${opp.locationType}</div>
      </div>
      <button data-id="${opp.id}">Details</button>
    `;

    grid.appendChild(card);
  });
}

grid.addEventListener("click", function(e){
  if(e.target.tagName === "BUTTON"){
    const id = e.target.dataset.id;
    const opp = opportunities.find(o => o.id === id);
    if(!opp) return;

    modalTitle.textContent = opp.title;
    modalBody.innerHTML = `
      <p>${opp.description.replaceAll("\n","<br>")}</p>
      ${opp.url ? `<p><a href="${opp.url}" target="_blank">Open Link â†—</a></p>` : ""}
    `;

    backdrop.classList.add("open");
  }
});

closeBtn.addEventListener("click", () => backdrop.classList.remove("open"));
backdrop.addEventListener("click", e => {
  if(e.target === backdrop) backdrop.classList.remove("open");
});

loadData();

</script>
</body>
</html>
